# Quiz Game — Проектирование API

## Базовый URL
```
/api/v1
```

## Аутентификация
- **Ведущий**: JWT-токен (login/register → получение токена → передача в заголовке `Authorization: Bearer <token>`).
- **Бот (участник)**: API-ключ бота в заголовке + Telegram ID участника.

---

## Эндпоинты

### Auth (Ведущий)

| Метод  | Путь                    | Описание                  | Auth  |
|--------|-------------------------|---------------------------|-------|
| POST   | `/auth/register`        | Регистрация ведущего      | —     |
| POST   | `/auth/login`           | Авторизация ведущего      | —     |

---

### Settings (Настройки ведущего)

| Метод  | Путь                    | Описание                        | Auth  |
|--------|-------------------------|---------------------------------|-------|
| GET    | `/settings`             | Получить настройки              | JWT   |
| PUT    | `/settings`             | Обновить настройки (bot_token, bot_link) | JWT   |

---

### Quizzes (CRUD квизов)

| Метод  | Путь                    | Описание                        | Auth       |
|--------|-------------------------|---------------------------------|------------|
| GET    | `/quizzes`              | Список квизов текущего ведущего | JWT        |
| POST   | `/quizzes`              | Создать квиз                    | JWT        |
| GET    | `/quizzes/:id`          | Получить квиз с вопросами       | JWT        |
| PUT    | `/quizzes/:id`          | Обновить квиз                   | JWT        |
| DELETE | `/quizzes/:id`          | Удалить квиз                    | JWT        |

---

### Questions (вопросы внутри квиза)

| Метод  | Путь                              | Описание                  | Auth  |
|--------|-----------------------------------|---------------------------|-------|
| POST   | `/quizzes/:id/questions`          | Добавить вопрос           | JWT   |
| PUT    | `/questions/:id`                  | Обновить вопрос           | JWT   |
| DELETE | `/questions/:id`                  | Удалить вопрос            | JWT   |

---

### Sessions (сессии квиза)

| Метод  | Путь                              | Описание                          | Auth       |
|--------|-----------------------------------|-----------------------------------|------------|
| GET    | `/sessions`                       | Список сессий ведущего            | JWT        |
| POST   | `/sessions`                       | Создать сессию (запустить квиз)   | JWT        |
| GET    | `/sessions/:id`                   | Получить состояние сессии         | JWT / Bot  |
| POST   | `/sessions/:id/reveal`            | Показать правильный ответ         | JWT        |
| POST   | `/sessions/:id/next`              | Перейти к следующему вопросу      | JWT        |
| GET    | `/sessions/:id/leaderboard`       | Таблица лидеров                   | JWT / Bot  |

---

### Participants (участники)

| Метод  | Путь                                   | Описание                             | Auth  |
|--------|----------------------------------------|--------------------------------------|-------|
| POST   | `/sessions/join`                       | Присоединиться к сессии (по коду)    | Bot   |
| POST   | `/sessions/:id/answer`                 | Отправить/изменить ответ на вопрос   | Bot   |
| GET    | `/sessions/:id/my-result`              | Результат участника за текущий вопрос | Bot   |

**Изменение ответа**: повторный `POST /sessions/:id/answer` с другим `option_id` обновляет ответ, пока статус = `question`.

---

### Internal (для бота)

| Метод  | Путь                              | Описание                                    | Auth  |
|--------|-----------------------------------|---------------------------------------------|-------|
| GET    | `/internal/bot-tokens`            | Список всех токенов ботов из настроек хостов | Bot   |

---

### Polling / Real-time

Для обновления экрана ведущего и бота в реальном времени:
- **Вариант 1**: WebSocket-соединение (`/ws/session/:id`) — предпочтительно для экрана ведущего.
- **Вариант 2**: Polling `/sessions/:id` — запасной вариант для бота.

---

## Статусы сессии

| Статус          | Описание                                      |
|-----------------|-----------------------------------------------|
| `waiting`       | Ожидание участников (показ QR-кода)           |
| `question`      | Показан вопрос, приём ответов                 |
| `revealed`      | Правильный ответ показан, ответы не принимаются|
| `finished`      | Квиз завершён, доступна таблица лидеров       |
